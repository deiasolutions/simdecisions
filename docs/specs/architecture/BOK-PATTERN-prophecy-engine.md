# BOK Pattern: The Prophecy Engine

**Pattern ID:** BOK-SIM-002
**Category:** Simulation Architecture — Predictive Extension
**Date:** 2026-02-04
**Author:** daaaave-atx × Claude (Anthropic)
**Status:** Draft — Architectural Concept for Phase 3+
**Depends On:** BOK-SIM-001 (Oort Cloud Partitioning)

---

## Problem

Organizations make decisions with incomplete information about the future. Traditional forecasting tools (spreadsheets, statistical models) operate outside the operational system — they predict in isolation, disconnected from the execution environment where decisions actually happen. Meanwhile, simulation tools model mechanics but don't incorporate judgment. And LLM-based agents can reason but can't run thousands of scenarios at statistical scale.

No existing tool combines all three: **mechanical simulation + statistical prediction + intelligent judgment.**

---

## Solution: The Prophecy Engine

Extend the Oort Cloud partitioning model (BOK-SIM-001) to treat fast-running partitions as **forecast generators.** When a partition computes ahead of the master clock, its outputs are not facts — they are **prophecies**: probabilistic predictions about future states, tagged with confidence intervals derived from Monte Carlo repetition.

At decision nodes within the simulation, **oracle plugins** (LLMs or other reasoning systems) evaluate prophecies and recommend actions. Those recommended actions are themselves simulatable, creating a recursive loop: predict the future, simulate the intervention, measure whether the intervention improves the outcome, and report the confidence-weighted recommendation.

---

## Core Concepts

### Prophecy

A prophecy is an event generated by a partition running ahead of the master clock. It describes something that *would* happen at a future time, given current trajectories.

```yaml
prophecy:
  id: "PROPH-20260204-001"
  source_partition: "demand-forecast"
  prophecy_time: "2026-02-04T17:00:00Z"    # when this would occur
  generated_at_clock: "2026-02-04T15:00:00Z" # current sim time
  horizon_seconds: 7200                      # how far ahead
  event_type: "customer_decommit"
  subject: "order-4471"
  
  # Confidence from Monte Carlo
  confidence: 0.73
  runs: 500
  positive_outcomes: 365      # times this event occurred
  variance: 0.12
  distribution: "beta(365, 135)"
  
  # Causal chain
  contributing_factors:
    - "engagement_score_declining_14d"
    - "support_tickets_unresolved: 3"
    - "competitor_pricing_event_detected"
  
  # Tachyon metadata (from BOK-SIM-001)
  causal_integrity: "prescient"
  tachyon_delta: -7200
```

### Oracle

An oracle is a reasoning plugin invoked at decision nodes. It evaluates a prophecy and recommends an action. Oracles exist at three tiers of intelligence and cost:

| Tier | Name | Reasoning | Cost | Use When |
|------|------|-----------|------|----------|
| 1 | **Deterministic** | Rules-based. If/then/else. | Near zero | Decision is mechanical: reorder when stock < threshold |
| 2 | **Statistical** | Probability models, ML classifiers, regression | Low | Decision benefits from historical pattern matching |
| 3 | **LLM Oracle** | Full natural language reasoning (Claude, GPT, etc.) | High | Decision requires judgment, context, nuance, creativity |

The DES engine selects oracle tier based on decision node configuration. Most nodes use Tier 1 or 2. LLM oracles fire only at high-value nodes where judgment matters.

```yaml
oracle_invocation:
  prophecy_id: "PROPH-20260204-001"
  oracle_tier: 3
  oracle_model: "claude-sonnet-4-5"
  
  # What the oracle was asked
  prompt_summary: |
    Customer order-4471 has 73% probability of decommit within 2 hours.
    Contributing factors: declining engagement, unresolved tickets, competitor pricing.
    Available actions: proactive outreach, discount offer, production throttle, no action.
    Evaluate each action considering customer relationship value and production cost.
  
  # What the oracle recommended
  recommended_action: "proactive_outreach"
  action_rationale: "High-value relationship customer (LTV $340K). Three unresolved 
    tickets suggest service failure, not price sensitivity. Outreach to resolve 
    tickets likely sufficient without discount."
  action_confidence: 0.81
  
  # Cost of this oracle call
  tokens_used: 847
  estimated_cost_usd: 0.0034
```

### Intervention Simulation

The recommended action is not taken blindly. It is **simulated.** The DES engine forks the scenario:

- **Branch A (baseline):** No intervention. Let the decommit happen.
- **Branch B (intervention):** Apply the recommended action. Measure outcome.

Both branches run to completion (or to a defined evaluation horizon). The difference in outcomes is the **value of the intervention.**

```yaml
intervention_analysis:
  prophecy_id: "PROPH-20260204-001"
  action: "proactive_outreach"
  
  # Branch A: No intervention
  baseline:
    runs: 500
    decommit_rate: 0.73
    revenue_lost_mean: 84200
    revenue_lost_p95: 112000
  
  # Branch B: With intervention  
  intervention:
    runs: 500
    decommit_rate: 0.19
    revenue_lost_mean: 22100
    revenue_lost_p95: 41000
    intervention_cost: 350          # cost of the outreach itself
  
  # Value of intervention
  expected_value_of_action: 61750   # mean revenue saved minus intervention cost
  confidence: 0.81
  recommendation: "INTERVENE"
  
  # Value of information (the prophecy itself)
  value_of_information: 61750       # knowing early enough to act
  voi_confidence: 0.73              # limited by prophecy confidence
```

---

## Monte Carlo Integration

Confidence intervals come from repetition. The Prophecy Engine runs scenarios multiple times with **jittered inputs** — small random perturbations to arrival rates, processing times, agent availability, decision outcomes, and external events.

### Jitter Sources

| Parameter | Jitter Method | Purpose |
|-----------|---------------|---------|
| Arrival rates | Poisson variation | Demand uncertainty |
| Processing times | Log-normal variation | Task duration uncertainty |
| Agent availability | Bernoulli dropout | Staffing uncertainty |
| Decision outcomes | Probability-weighted branching | Human unpredictability |
| External events | Scenario injection (random timing) | Market/environmental uncertainty |
| Customer behavior | Behavioral model + noise | Individual variation |

### Run Configuration

```yaml
monte_carlo:
  base_scenario: "demand-forecast-q2"
  runs: 500                    # minimum for useful confidence intervals
  jitter_seed: 42              # reproducible randomness
  jitter_profile: "moderate"   # low / moderate / high variance
  
  # What to measure
  metrics:
    - "total_revenue"
    - "orders_fulfilled"
    - "orders_decommitted"
    - "agent_utilization"
    - "customer_satisfaction_proxy"
  
  # Evaluation horizon
  sim_duration: "30d"
  checkpoint_interval: "1d"    # save state daily for analysis
  
  # Oracle budget
  max_oracle_calls_per_run: 50
  oracle_budget_usd: 5.00      # cap LLM spend per Monte Carlo batch
```

### Output

```yaml
monte_carlo_results:
  scenario: "demand-forecast-q2"
  runs_completed: 500
  
  total_revenue:
    mean: 2340000
    median: 2310000
    std: 185000
    p5: 2020000           # pessimistic
    p25: 2210000
    p75: 2450000
    p95: 2680000           # optimistic
    
  orders_decommitted:
    mean: 14.2
    median: 13
    p95: 23                # worst case
    
  # Prophecies generated across all runs
  prophecies_generated: 3847
  unique_prophecy_types: 12
  interventions_recommended: 891
  interventions_with_positive_ev: 743   # 83% hit rate
  
  # Oracle economics
  total_oracle_calls: 4200
  total_oracle_cost_usd: 16.80
  cost_per_actionable_insight: 0.023
```

---

## Economic Modeling

The Prophecy Engine enables simulation of economic systems through composable logical plugins. Each economic actor (customer, supplier, competitor, market) is modeled as a partition with configurable behavior:

### Actor Types

| Actor | Behavior Model | Oracle Tier |
|-------|---------------|-------------|
| **Individual customer** | Engagement score + churn probability + relationship history | Tier 2 (statistical) or Tier 3 (LLM) for high-value |
| **Customer segment** | Aggregate demand curve + price elasticity | Tier 2 (statistical) |
| **Competitor** | Pricing rules + market share response function | Tier 1 (deterministic) or Tier 2 |
| **Supplier** | Lead time distribution + capacity constraints | Tier 1 (deterministic) |
| **Market** | Macro trend + seasonal pattern + random shock | Tier 2 (statistical) |
| **Regulator** | Policy change probability + implementation lag | Tier 3 (LLM for complex policy) |

### Demand Modeling

For commodity items where demand forecasting drives production:

```yaml
demand_model:
  type: "commodity"
  
  # Current demand signal
  current_orders: 1247
  order_rate_per_day: 42
  trend: "declining"        # from time series analysis
  
  # Prophecy: future demand
  forecast_horizon: "90d"
  confidence_bands:
    p10: 28                 # pessimistic daily rate
    p50: 37                 # expected daily rate  
    p90: 51                 # optimistic daily rate
  
  # Production response options (each simulatable)
  responses:
    - name: "maintain_production"
      action: "keep current rate"
      risk: "overproduction if demand drops"
    - name: "throttle_10pct"
      action: "reduce production 10%"
      risk: "stockout if demand holds"
    - name: "throttle_25pct_with_outreach"
      action: "reduce 25%, contact top 20 customers"
      risk: "moderate, offset by relationship signal"
```

### Relationship vs. Commodity Decision Logic

The Prophecy Engine distinguishes between relationship and commodity contexts at the oracle level:

```yaml
# Relationship context: individual customer matters
if customer.ltv > threshold AND customer.relationship_type == "strategic":
    oracle_tier: 3                    # LLM evaluates nuance
    action_space: ["outreach", "discount", "escalate_to_account_manager"]
    priority: "retain_relationship"

# Commodity context: aggregate demand matters  
if product.type == "commodity" AND customer.relationship_type == "transactional":
    oracle_tier: 2                    # statistical model sufficient
    action_space: ["adjust_production", "adjust_pricing", "hold"]
    priority: "optimize_margin"
```

---

## Value of Information (VOI)

The most powerful metric the Prophecy Engine produces. VOI measures the dollar value of knowing something early enough to act on it.

```
VOI = E[outcome_with_prophecy] - E[outcome_without_prophecy]
```

Calculated by comparing:
- **Blind run:** Strict causality. Agents discover events naturally. No prescience.
- **Prophetic run:** Prescient mode. Agents receive forecasts and can act on them.

The delta is VOI. This is the number that justifies the entire system.

### VOI Report

```yaml
value_of_information_report:
  scenario: "q2-demand-forecast"
  comparison_runs: 500           # each mode
  
  blind_mode:
    revenue: { mean: 2120000, p5: 1840000 }
    waste: { mean: 147000 }
    customer_churn: { mean: 18 }
    
  prophetic_mode:
    revenue: { mean: 2340000, p5: 2020000 }
    waste: { mean: 89000 }
    customer_churn: { mean: 11 }
    
  value_of_information:
    revenue_delta: 220000
    waste_reduction: 58000
    churn_prevention: 7 customers
    total_voi: 278000
    
    # Per-prophecy-type breakdown
    by_type:
      customer_decommit: { voi: 184000, frequency: 14 }
      demand_shift: { voi: 62000, frequency: 3 }
      supplier_delay: { voi: 32000, frequency: 8 }
    
    # What this means
    interpretation: |
      The forecasting system generates $278K in value per quarter
      by enabling proactive intervention. The highest-value prophecy
      type is customer decommit prediction ($184K, 66% of total VOI).
      Recommendation: prioritize churn prediction model accuracy.
```

---

## Mapping to SimDecisions Architecture

| Prophecy Engine Component | SimDecisions Component | Phase |
|--------------------------|----------------------|-------|
| Prophecy generation | Fast-running DES partitions (Oort Cloud) | Phase 3 |
| Monte Carlo runner | DES engine with jittered inputs | Phase 3 |
| Tier 1 oracle (deterministic) | Python script bees | Exists |
| Tier 2 oracle (statistical) | ML model bees (new agent type) | Phase 3+ |
| Tier 3 oracle (LLM) | Claude/GPT bees via adapter | Exists |
| Intervention simulation | DES branching from checkpoint | Phase 3 |
| VOI calculation | Comparison of blind vs. prophetic runs | Phase 3 |
| Confidence intervals | Monte Carlo aggregation | Phase 3 |
| Prophecy event logging | Event ledger with tachyon tags | Phase 2 (TASK-009) |
| Oracle cost tracking | Cost tracking per oracle call | Phase 2 (TASK-010) |

---

## Mapping to DEIA Governance

| Governance Principle | Prophecy Engine Application |
|---------------------|---------------------------|
| Human Sovereignty (No. 16) | Human reviews prophecies before intervention. LLM recommends, human decides. |
| Coordination & Conscience (No. 4) | Oracles carry moral checksum. Interventions evaluated for ethics, not just ROI. |
| Protocol of Grace (No. 7) | Customer outreach follows grace protocol: pause, listen, reflect, respond, rejoin. |
| Evolutionary Governance (No. 13) | Oracle models compete. Tier 2 vs Tier 3 accuracy tracked. Best model wins. |
| Energy & Entropy (No. 12) | Oracle budget enforced. LLM calls are expensive energy. Use wisely. |
| Common Good (No. 10) | VOI measures value to the whole system, not just one partition. |

---

## Design Principles

1. **Prophecies are probabilistic, never certain.** Always carry confidence intervals. Never present a forecast as fact.

2. **Oracles are bounded, never unbounded.** The LLM answers specific questions at specific nodes. It does not run the simulation. The DES engine runs the simulation.

3. **Interventions are simulated before execution.** Never act on a prophecy without modeling the intervention's expected outcome.

4. **VOI is the ultimate metric.** If the prophecy system doesn't generate measurable value, simplify or remove it.

5. **Oracle tier selection is economic.** Don't use a $0.03 LLM call when a $0.00001 rule covers it. Escalate tier only when the decision value justifies the oracle cost.

6. **The human is always the final oracle.** In production mode, prophecies with intervention recommendations go to a human dashboard. The human approves, modifies, or rejects. In simulation mode, the LLM can stand in for the human to enable Monte Carlo at scale.

---

## Implementation Sequence

1. **Phase 2 (current):** Event ledger (TASK-009) supports tachyon tags. Cost tracking (TASK-010) supports oracle cost logging.
2. **Phase 3:** DES engine with branching from checkpoints. Monte Carlo runner with jittered inputs. Tier 1 oracles at decision nodes.
3. **Phase 3+:** Tier 2 oracles (statistical models). VOI calculation. Intervention simulation.
4. **Phase 4:** Dashboard shows prophecies, confidence intervals, VOI report. Visual comparison of blind vs. prophetic runs.
5. **Post-v1.0:** Tier 3 oracles (LLM). Real-time prophecy in production mode. Adaptive oracle tier selection.

---

*"The purpose of prophecy is not to know the future. It is to know the value of knowing the future — and to act wisely on that knowledge."*

---

**License:** CC BY 4.0 International
**Copyright:** © 2026 DEIA Global Commons
